ifndef HOST_ARCH
  HOST_ARCH:=solaris
endif

EPICS:=/net/cdaqfs/home/EPICS/dvlepics/R3.13.2.0.J0
TOP:=/net/cdaqfs/home/EPICS/dvlepics/R3.13.2.0.J0
BINDIR=${EPICS}/base/bin/${HOST_ARCH}
PATH:=${EPICS}/appSRcebaf/tools:${BINDIR}:${PATH}

# Makefile for Hac_DYNPWR application 
# Develop EPICS database by using Capfast
# This Makefile is generated by mkNewapp script

AppName = CaenScaler

# Use these lists to make ioc groupings (if needed)
#IocINJ  = in1 in2 in3 in4 in5
#IocNL   = nl1b nl1 nl2 nl3 nl4 nl5
#IocSL	= sl1b sl1 sl2 sl3 sl4 sl5
#IocWA	= wa1 wa2 wa3 wa4 wa5 wa6
#IocEA	= ea1 ea2 ea3 ea4 ea5 ea6
#IocHALL = hla hlb hlc hlc2
#IocOPS = m56 s56
#IocCRYO =  ctf ch1 ch2 ch3 ch4 ch5 ch6 sbr hla2 esr
#IocFEL = fel1 fel2 fel3 fel4 fel5 fel6 fel7 fel8

# Combine above lists here or just list the iocs for each server here. 
# There is a separate list for each server (acc, FEL, chl, dvl).
AccIocList = 
FELIocList = 
CHLIocList = 
TestIocList = vmec15 g0ioc4 vmec20 vmec1

# This is the final list
# 
IocList = $(AccIocList) $(FELIocList) $(CHLIocList) $(TestIocList)

all:
      ifneq ($(strip $(IocList)),)
	@echo "\n******************** BUILD ALL ********************"
	@(for theIOC in ${IocList}; do $(MAKE) $$theIOC; done)
      else
	@echo "\n***************** NO IOCS TO BUILD ****************\n"
      endif

acc:
      ifneq ($(strip $(AccIocList)),)
	@echo "\n******************** BUILD ACC ********************"
	@(for theIOC in ${AccIocList}; do $(MAKE) $$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO BUILD FOR ACC **************\n"
      endif

fel:
      ifneq ($(strip $(FELIocList)),)
	@echo "\n******************** BUILD FEL ********************"
	@(for theIOC in ${FELIocList}; do $(MAKE) $$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO BUILD FOR FEL **************\n"
      endif

chl:
      ifneq ($(strip $(CHLIocList)),)
	@echo "\n******************** BUILD CHL ********************"
	@(for theIOC in ${CHLIocList}; do $(MAKE) $$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO BUILD FOR CHL **************\n"
      endif

test:
      ifneq ($(strip $(TestIocList)),)
	@echo "\n******************** BUILD TEST ********************"
	@(for theIOC in ${TestIocList}; do $(MAKE) $$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO BUILD FOR TEST **************\n"
      endif

%:
	@echo "\n==================== BUILD IOC ioc$* ===================="
	$(MAKE) -f Makefile.ioc IOC=$* APP=$(AppName) $*

clean:
      ifneq ($(strip $(IocList)),)
	@echo "\n******************** CLEAN ALL ********************"
	@(for theIOC in ${IocList}; do $(MAKE) clean_$$theIOC; done)
      else
	@echo "\n*************** NO IOCS TO CLEAN ******************\n"
      endif

clean_acc:
      ifneq ($(strip $(AccIocList)),)
	@echo "\n******************** CLEAN ACC ********************"
	@(for theIOC in ${AccIocList}; do $(MAKE) clean_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO CLEAN FOR ACC **************\n"
      endif

clean_fel:
      ifneq ($(strip $(FELIocList)),)
	@echo "\n******************** CLEAN FEL ********************"
	@(for theIOC in ${FELIocList}; do $(MAKE) clean_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO CLEAN FOR FEL **************\n"
      endif

clean_chl:
      ifneq ($(strip $(CHLIocList)),)
	@echo "\n******************** CLEAN CHL ********************"
	@(for theIOC in ${CHLIocList}; do $(MAKE) clean_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO CLEAN FOR CHL **************\n"
      endif

clean_test:
      ifneq ($(strip $(TestIocList)),)
	@echo "\n******************** CLEAN TEST ********************"
	@(for theIOC in ${TestIocList}; do $(MAKE) clean_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO CLEAN FOR TEST **************\n"
      endif

clean_%:
	@echo "\n==================== CLEAN IOC ioc$* ===================="
	$(MAKE) -f Makefile.ioc IOC=$* APP=$(AppName) clean

install_acc:
      ifneq ($(strip $(AccIocList)),)
	@echo "\n******************** INSTALL ACC *******************"
	@(for theIOC in ${AccIocList}; do $(MAKE) install_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO INSTALL FOR ACC *************\n"
      endif

install_fel:
      ifneq ($(strip $(FELIocList)),)
	@echo "\n******************** INSTALL FEL ********************"
	@(for theIOC in ${FELIocList}; do $(MAKE) install_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO INSTALL FOR FEL **************\n"
      endif

install_chl:
      ifneq ($(strip $(CHLIocList)),)
	@echo "\n******************** INSTALL CHL ********************"
	@(for theIOC in ${CHLIocList}; do $(MAKE) install_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO INSTALL FOR CHL **************\n"
      endif

install_test:
      ifneq ($(strip $(TestIocList)),)
	@echo "\n******************** INSTALL TEST ********************"
	@(for theIOC in ${TestIocList}; do $(MAKE) install_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO INSTALL FOR TEST **************\n"
      endif

install_all:
      ifneq ($(strip $(IocList)),)
	@echo "\n******************** INSTALL ALL ********************"
	@(for theIOC in ${IocList}; do $(MAKE) install_$$theIOC; done)
      else
	@echo "\n*********** NO IOCS TO INSTALL FOR ALL **************\n"
      endif

install:
	@echo "\n******************** INSTALL NOTHING ********************"
	@echo   "************ Must run:  make install_ioc ************\n"
	@echo   "************        or  make install_acc ************\n"
	@echo   "************        or  make install_fel ************\n"
	@echo   "************        or  make install_chl ************\n"
	@echo   "************        or  make install_test ***********\n"
	@echo   "************        or  make install_all ************\n"

install_%:
	@echo "\n==================== INSTALL IOC ioc$* ===================="
	$(MAKE) -f Makefile.ioc IOC=$* APP=$(AppName) install


depends_acc:
      ifneq ($(strip $(AccIocList)),)
	@echo "\n******************** DEPENDS ACC ********************"
	@(for theIOC in ${AccIocList}; do $(MAKE) depends_$$theIOC; done)
      else
	@echo "\n************* NO ACC IOCS FOR DEPENDS ***************\n"
      endif

depends_fel:
      ifneq ($(strip $(FELIocList)),)
	@echo "\n******************** DEPENDS FEL ********************"
	@(for theIOC in ${FELIocList}; do $(MAKE) depends_$$theIOC; done)
      else
	@echo "\n************* NO FEL IOCS FOR DEPENDS ***************\n"
      endif

depends_chl:
      ifneq ($(strip $(CHLIocList)),)
	@echo "\n******************** DEPENDS CHL ********************"
	@(for theIOC in ${CHLIocList}; do $(MAKE) depends_$$theIOC; done)
      else
	@echo "\n************* NO CHL IOCS FOR DEPENDS ***************\n"
      endif

depends_test:
      ifneq ($(strip $(TestIocList)),)
	@echo "\n******************** DEPENDS TEST ********************"
	@(for theIOC in ${TestIocList}; do $(MAKE) depends_$$theIOC; done)
      else
	@echo "\n************* NO TEST IOCS FOR DEPENDS ***************\n"
      endif

depends:
	@echo "\n******************** DEPENDS NOTHING ********************"
	@echo   "************ Must run:  make depends_<something> ***********\n"

depends_%:
	@echo "\n==================== DEPENDS IOC ioc$* ===================="
	$(MAKE) -f Makefile.ioc IOC=$* APP=$(AppName) depends

